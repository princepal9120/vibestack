// Vibe Stack - Prisma Schema
// Based on Tech Spec v1.0

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// =============================================================================
// User Model (synced from Clerk via webhook)
// =============================================================================
model User {
  id        String   @id @default(cuid())
  clerkId   String   @unique
  email     String   @unique
  username  String   @unique
  avatar    String?
  bio       String?
  githubUrl String?
  twitterUrl String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  projects  Project[]
  comments  Comment[]
  upvotes   Upvote[]

  @@index([clerkId])
  @@index([username])
}

// =============================================================================
// Project Model
// =============================================================================
model Project {
  id              String   @id @default(cuid())
  title           String
  description     String
  longDescription String?  @db.Text
  
  // Author relation
  authorId        String
  author          User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  
  // Categorization
  platforms       String[] // e.g., ["cursor", "claude-code"]
  techStack       String[] // e.g., ["react", "typescript", "tailwind"]
  category        String   // e.g., "web-app", "cli", "mobile"
  
  // Links
  githubUrl       String?
  liveUrl         String?
  
  // Media
  screenshots     String[] // Cloudinary URLs
  
  // Content
  keyInsights     String?  @db.Text // Markdown
  
  // Denormalized counts (for performance)
  upvoteCount     Int      @default(0)
  commentCount    Int      @default(0)
  viewCount       Int      @default(0)
  
  // Flags
  featured        Boolean  @default(false)
  
  // Timestamps
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  comments        Comment[]
  upvotes         Upvote[]

  @@index([authorId])
  @@index([category, createdAt(sort: Desc)])
  @@index([upvoteCount(sort: Desc), createdAt(sort: Desc)])
}

// =============================================================================
// Comment Model
// =============================================================================
model Comment {
  id          String   @id @default(cuid())
  content     String   @db.Text
  
  // Relations
  projectId   String
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  
  authorId    String
  author      User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([projectId])
  @@index([authorId])
}

// =============================================================================
// Upvote Model
// =============================================================================
model Upvote {
  id        String   @id @default(cuid())
  
  // Relations
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  projectId String
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())

  @@unique([userId, projectId])
  @@index([projectId])
}

// =============================================================================
// Collection Model (Admin-curated)
// =============================================================================
model Collection {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  description String   @db.Text
  projectIds  String[] // Array of project IDs
  curator     String?  // Optional curator name
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([slug])
}

// =============================================================================
// PlatformProfile Model (Static content for AI tools)
// =============================================================================
model PlatformProfile {
  id          String   @id @default(cuid())
  platformId  String   @unique // e.g., "cursor", "claude-code"
  name        String   // e.g., "Cursor"
  tagline     String?
  websiteUrl  String?
  description String   @db.Text
  setupGuide  String   @db.Text // Markdown
  cheatSheet  String[] // Array of key points
  
  // New fields for enhanced content
  prompts     PromptTemplate[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([platformId])
}



// =============================================================================
// PromptTemplate Model (Claude skills, prompt patterns)
// =============================================================================
model PromptTemplate {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  description String
  prompt      String   @db.Text // The actual prompt template
  category    String   // e.g., "coding", "debugging", "documentation", "refactoring"
  useCase     String?  // Specific use case description
  
  // Platform relation
  platformId  String
  platform    PlatformProfile @relation(fields: [platformId], references: [id], onDelete: Cascade)
  
  // Engagement
  useCount    Int      @default(0)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([platformId])
  @@index([category])
  @@index([slug])
}

// =============================================================================
// Resource Model (External content: blogs, articles, X posts, YouTube)
// =============================================================================
enum ResourceStatus {
  PENDING
  APPROVED
  REJECTED
}

model Resource {
  id          String   @id @default(cuid())
  title       String
  description String?
  url         String   @unique
  type        String   // "blog", "article", "x_post", "youtube", "tutorial"
  source      String?  // e.g., "Dev.to", "Medium", "YouTube", "X/Twitter"
  author      String?  // Original author name
  thumbnail   String?  // Preview image URL
  
  // Moderation
  status      ResourceStatus @default(PENDING)
  
  // Categorization
  platforms   String[] // Related platforms ["cursor", "claude-code"]
  tags        String[] // e.g., ["beginner", "workflow", "tips"]
  
  // Engagement
  viewCount   Int      @default(0)
  featured    Boolean  @default(false)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([type])
  @@index([status])
  @@index([featured])
}

// =============================================================================
// EndToEndGuide Model (Complete journey collections)
// =============================================================================
model EndToEndGuide {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  description String   @db.Text
  content     String   @db.Text // Full markdown guide
  
  // What was built
  outcome     String?  // e.g., "Built a full-stack SaaS in 2 weeks"
  
  // Journey details
  platforms   String[] // Platforms used
  techStack   String[] // Tech stack used
  duration    String?  // e.g., "2 weeks", "1 month"
  
  // Author (optional - can be community submitted)
  authorName  String?
  authorUrl   String?
  
  // Related project
  projectId   String?  // Link to a Project if applicable
  
  // Engagement
  viewCount   Int      @default(0)
  featured    Boolean  @default(false)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([slug])
  @@index([featured])
}

// =============================================================================
// MCPServer Model (Model Context Protocol integrations)
// =============================================================================
model MCPServer {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String   @db.Text
  
  // Provider/source info
  provider    String   // e.g., "official", "community"
  category    String   // e.g., "database", "cloud", "monitoring", "design", "productivity"
  
  // Installation & Usage
  installCommand String?  // e.g., "npm install @mcp/supabase"
  configExample  String?  @db.Text // JSON/YAML config example
  docsUrl        String?
  repoUrl        String?
  
  // Visual
  iconUrl     String?
  
  // Platforms it works with
  platforms   String[] // ["claude-code", "cursor"]
  
  // Engagement
  useCount    Int      @default(0)
  featured    Boolean  @default(false)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([slug])
  @@index([category])
  @@index([featured])
}

// =============================================================================
// SubAgent Model (Role-specific AI agent prompts)
// =============================================================================
model SubAgent {
  id          String   @id @default(cuid())
  name        String   // e.g., "React Architect", "Python Expert"
  slug        String   @unique
  
  // Role/Persona
  role        String   // Brief role description
  systemPrompt String  @db.Text // The full system prompt
  
  // Categorization
  category    String   // e.g., "frontend", "backend", "devops", "testing", "database", "mobile"
  language    String?  // Primary language: "typescript", "python", "go", etc.
  framework   String?  // Primary framework: "react", "nextjs", "django", etc.
  
  // Guidance
  whenToUse   String?  @db.Text // When to trigger this sub-agent
  examples    String[] // Example use cases
  
  // Platforms it works with  
  platforms   String[] // ["claude-code", "cursor"]
  
  // Engagement
  useCount    Int      @default(0)
  featured    Boolean  @default(false)
  
  // Author (for community contributions)
  authorName  String?
  authorUrl   String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([slug])
  @@index([category])
  @@index([language])
  @@index([featured])
}

// =============================================================================
// Skill Model (Agent Skills - modular capabilities like Anthropic's Skills)
// =============================================================================
model Skill {
  id           String   @id @default(cuid())
  name         String
  slug         String   @unique
  tagline      String   // Short description
  description  String   @db.Text // Full description with markdown
  
  // The actual skill content
  instructions String   @db.Text // The instructions/prompt for the skill
  
  // Categorization
  category     String   // e.g., "document", "coding", "data", "workflow", "automation"
  
  // Compatibility
  platforms    String[] // ["claude-code", "cursor", "gemini-cli", "opencode", "copilot"]
  
  // Usage & Examples
  examples     String[] // Example use cases
  triggers     String[] // Keywords/scenarios that trigger this skill
  
  // Author info
  authorName   String?
  authorUrl    String?
  repoUrl      String?
  
  // Visual
  iconUrl      String?
  
  // Provider
  provider     String   @default("community") // "official", "community", "verified"
  
  // Engagement
  useCount     Int      @default(0)
  featured     Boolean  @default(false)
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([slug])
  @@index([category])
  @@index([featured])
}

